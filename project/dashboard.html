<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI IDS Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- Top Navbar -->
  <nav class="navbar">
    <h2 class="logo">ðŸ›¡ AI IDS Dashboard</h2>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </nav>

  <!-- Alert Banner -->
  <div class="alert-banner" id="alertBanner">
    âš  Intrusion Detection System Monitoring Live Traffic...
  </div>

  <!-- Main Dashboard Grid -->
  <main class="dashboard-container">

    <!-- System Status Cards -->
    <div class="card">
      <h3>SDN Controller</h3>
      <p class="status active" id="sdnStatus">Loading...</p>
    </div>

    <div class="card">
      <h3>AI Model</h3>
      <p class="status active" id="aiStatus">Loading...</p>
    </div>

    <div class="card">
      <h3>Traffic Monitor</h3>
      <p class="status warning" id="trafficStatus">Loading...</p>
    </div>

    <div class="card">
      <h3>Threat Level</h3>
      <p class="status danger" id="threatStatus">Loading...</p>
    </div>

    <!-- Charts Section -->
    <div class="chart-box">
      <h3>Network Traffic Distribution</h3>
      <div class="chart-placeholder">Live Traffic Visualization</div>
    </div>

    <div class="chart-box">
      <h3>Intrusion Timeline</h3>
      <div class="chart-placeholder">Real-Time Attack Timeline</div>
    </div>

    <!-- Logs Table -->
    <div class="logs-box">
      <h3>Live Intrusion Logs</h3>
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>Source IP</th>
            <th>Attack Type</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="logsTable">
          <tr><td colspan="4">Loading logs from IDS...</td></tr>
        </tbody>
      </table>
    </div>

  </main>

<script>
  // ðŸ” Authentication Check
  if (!localStorage.getItem("auth")) {
    window.location.href = "login.html";
  }

  function logout() {
    localStorage.removeItem("auth");
    window.location.href = "login.html";
  }

  // ðŸš¨ Blinking Alert Banner
  setInterval(() => {
    document.getElementById("alertBanner").classList.toggle("blink");
  }, 1000);

  // ðŸŒ Backend API Base URL (Ubuntu VM)
  const API_BASE = "http://172.19.22.127:5000";

  // ðŸ“¡ Fetch System Status from Flask IDS Backend
  fetch(`${API_BASE}/status`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("sdnStatus").innerText = data.sdn_controller;
      document.getElementById("aiStatus").innerText = data.ai_model;
      document.getElementById("trafficStatus").innerText = data.traffic;
      document.getElementById("threatStatus").innerText = data.threat;
    })
    .catch(err => {
      console.error("Status Fetch Error:", err);
    });

  // ðŸ“œ Fetch Live Intrusion Logs
  fetch(`${API_BASE}/logs`)
    .then(res => res.json())
    .then(logs => {
      const table = document.getElementById("logsTable");
      table.innerHTML = "";

      logs.forEach(log => {
        table.innerHTML += `
          <tr>
            <td>${log.time}</td>
            <td>${log.ip}</td>
            <td>${log.attack}</td>
            <td class="${log.status === 'Blocked' ? 'danger' : 'warning'}">
              ${log.status}
            </td>
          </tr>
        `;
      });
    })
    .catch(err => {
      console.error("Logs Fetch Error:", err);
    });

</script>

</body>
</html>